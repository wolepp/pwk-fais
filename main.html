<!DOCTYPE html>
<!-- saved from url=(0089)https://pegaz.uj.edu.pl/pluginfile.php/3623218/mod_resource/content/1/threejs_test.html_. -->
<html lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Mieszkanie</title>

	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>

<body class="vsc-initialized">

	<script type="module">

		import * as THREE from 'https://unpkg.com/three/build/three.module.js';
		import Apartment from './Apartment.js';
		import { fit } from './Evaluator.js';
		import { createArray } from './utils.js';
		import { LENGTH, WIDTH } from './Values.js';

		import { TrackballControls } from 'https://unpkg.com/three/examples/jsm/controls/TrackballControls.js';

		var camera, scene, renderer, controls;

		init();
		animate();
		function rand(min, max) {
			min = Math.ceil(min);
			max = Math.floor(max);
			return Math.floor(Math.random() * (max - min)) + min;
		}
		function init() {

			renderer = new THREE.WebGLRenderer();
			renderer.setPixelRatio(window.devicePixelRatio);
			renderer.setSize(window.innerWidth, window.innerHeight);
			document.body.appendChild(renderer.domElement);

			scene = new THREE.Scene();
			scene.background = new THREE.Color(0xffffff);

			camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 1, 1000);
			camera.position.set(0, 0, 150);

			controls = new TrackballControls(camera, renderer.domElement);
			controls.minDistance = 10;
			controls.maxDistance = 150;

			scene.add(new THREE.AmbientLight(0x222222));

			var light = new THREE.PointLight(0xffffff);
			light.position.copy(camera.position);
			scene.add( light );

			// Ustawienia mieszkania
			let length = LENGTH
			let width = WIDTH
			let height = 1;

			// ustawienia populacji poczÄ…tkowej
			let n_osobnikow = 10;
			let liczbaScian = rand(2, 4);

			let populacja_3d = new THREE.Group();
			let populacja = createArray(n_osobnikow);

			for (let i = 0; i < n_osobnikow; i++) {
				let osobnik = new Apartment(length, width);
				for (let j = 0; j < liczbaScian; j++) {
					osobnik.putRandomWall();
				}
				osobnik.finish()

				let x_pos = i * length * 1.2;
				let fenotyp_3d = osobnik.getPhenotypeShapesGroup(x_pos, 0, height, );
				let fitness = fit(osobnik);

				var scoreSprite = makeTextSprite(fitness.toPrecision(3))
				scoreSprite.position.set(x_pos + 25, 0, height);
				scene.add(scoreSprite)

				populacja.push(osobnik);
				populacja_3d.add(fenotyp_3d);
			}
			scene.add(populacja_3d);
		}

		function makeTextSprite(message, parameters) {
			if ( parameters === undefined ) parameters = {};
	
			var fontface = parameters.hasOwnProperty("fontface") ? 
				parameters["fontface"] : "Arial";
			
			var fontsize = parameters.hasOwnProperty("fontsize") ? 
				parameters["fontsize"] : 18;
			
			var borderThickness = parameters.hasOwnProperty("borderThickness") ? 
				parameters["borderThickness"] : 2;
			
			var borderColor = parameters.hasOwnProperty("borderColor") ?
				parameters["borderColor"] : { r:0, g:0, b:0, a:1.0 };
			
			var backgroundColor = parameters.hasOwnProperty("backgroundColor") ?
				parameters["backgroundColor"] : { r:255, g:255, b:255, a:1.0 };

				
			var canvas = document.createElement('canvas');
			var context = canvas.getContext('2d');
			context.font = "Bold " + fontsize + "px " + fontface;
			
			// get size data (height depends only on font size)
			var metrics = context.measureText( message );
			var textWidth = metrics.width;
			
			// background color
			context.fillStyle   = "rgba(" + backgroundColor.r + "," + backgroundColor.g + ","
										+ backgroundColor.b + "," + backgroundColor.a + ")";
			// border color
			context.strokeStyle = "rgba(" + borderColor.r + "," + borderColor.g + ","
										+ borderColor.b + "," + borderColor.a + ")";

			context.lineWidth = borderThickness;
			roundRect(context, borderThickness/2, borderThickness/2, textWidth + borderThickness, fontsize * 1.4 + borderThickness, 6);
			// 1.4 is extra height factor for text below baseline: g,j,p,q.
			
			// text color
			context.fillStyle = "rgba(0, 0, 0, 1.0)";

			context.fillText( message, borderThickness, fontsize + borderThickness);
			
			// canvas contents will be used for a texture
			var texture = new THREE.Texture(canvas) 
			texture.needsUpdate = true;

			var spriteMaterial = new THREE.SpriteMaterial({ map: texture });
			var sprite = new THREE.Sprite( spriteMaterial );
			sprite.scale.set(40, 20,1.0);
			return sprite;	
		}

		// function for drawing rounded rectangles
		function roundRect(ctx, x, y, w, h, r) {
			ctx.beginPath();
			ctx.moveTo(x+r, y);
			ctx.lineTo(x+w-r, y);
			ctx.quadraticCurveTo(x+w, y, x+w, y+r);
			ctx.lineTo(x+w, y+h-r);
			ctx.quadraticCurveTo(x+w, y+h, x+w-r, y+h);
			ctx.lineTo(x+r, y+h);
			ctx.quadraticCurveTo(x, y+h, x, y+h-r);
			ctx.lineTo(x, y+r);
			ctx.quadraticCurveTo(x, y, x+r, y);
			ctx.closePath();
			ctx.fill();
			ctx.stroke();   
		}

		function animate() {

			requestAnimationFrame(animate);

			controls.update();
			renderer.render(scene, camera);

		}

	</script>




	<!-- <canvas width="1867" height="980" style="width: 1867px; height: 980px;"></canvas> -->
	<div id="pocket-extension-root">
		<div class="pocket-egasyq"></div>
	</div>
	<div id="pocket-extension-styles">
		<style data-emotion="pocket"></style>
	</div>
</body>

</html>